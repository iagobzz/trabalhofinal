<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lista de Tarefas</title>
  <style>
    :root {
      --bg: #f8fafc;
      --card: #ffffff;
      --text: #1f2937;
      --border: #e5e7eb;
      --task-bg: #f1f5f9;
      --task-border: #cbd5e1;
    }

    .dark {
      --bg: #0f172a;
      --card: #1e293b;
      --text: #f1f5f9;
      --border: #334155;
      --task-bg: #334155;
      --task-border: #475569;
    }

    * {
      box-sizing: border-box;
      font-family: 'Segoe UI', sans-serif;
    }

    body {
      margin: 0;
      background-color: var(--bg);
      color: var(--text);
      padding: 40px;
      transition: background-color 0.3s, color 0.3s;
    }

    .container {
      max-width: 600px;
      margin: auto;
      background: var(--card);
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
    }

    .theme-toggle {
      text-align: center;
      margin-bottom: 15px;
    }

    .theme-toggle button {
      padding: 8px 16px;
      background-color: #3b82f6;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    .task-input, .task-search {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }

    input, button {
      padding: 10px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background-color: var(--card);
      color: var(--text);
    }

    input[type="text"] {
      flex: 2;
    }

    input[type="time"], .task-search input {
      flex: 1;
    }

    button {
      background-color: #10b981;
      color: white;
      cursor: pointer;
      transition: 0.2s;
    }

    button:hover {
      background-color: #059669;
    }

    .filters {
      margin: 15px 0;
      display: flex;
      justify-content: space-around;
    }

    .filters button {
      background-color: #e2e8f0;
      color: #111827;
      border: none;
    }

    .dark .filters button {
      background-color: #475569;
      color: white;
    }

    .filters button.active {
      background-color: #3b82f6;
      color: white;
    }

    ul {
      list-style: none;
      padding: 0;
    }

    .task {
      display: flex;
      align-items: center;
      background: var(--task-bg);
      border: 1px solid var(--task-border);
      border-radius: 8px;
      padding: 10px 15px;
      margin-bottom: 10px;
      flex-wrap: wrap;
      cursor: move;
    }

    .task.completed .task-text {
      text-decoration: line-through;
      color: #9ca3af;
    }

    .task-info {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      margin-left: 10px;
    }

    .task-text {
      font-size: 1rem;
      margin-bottom: 3px;
    }

    .hora {
      font-size: 0.85rem;
      color: #475569;
    }

    .actions span {
      margin-left: 10px;
      cursor: pointer;
      color: var(--text);
    }

    .actions span:hover {
      color: #ef4444;
    }

    .edit:hover {
      color: #3b82f6;
    }

    input[type="checkbox"] {
      width: 20px;
      height: 20px;
    }
  </style>
</head>
<body>

<div class="container">
  <h1>üìã Lista de Tarefas</h1>

  <div class="theme-toggle">
    <button onclick="toggleTheme()">üåô Alternar tema</button>
  </div>

  <div class="task-input">
    <input type="text" id="taskText" placeholder="Digite uma tarefa...">
    <input type="time" id="taskTime">
    <button onclick="addTask()">Adicionar</button>
  </div>

  <div class="task-search">
    <input type="text" id="searchInput" placeholder="üîé Buscar tarefa..." oninput="renderTasks()">
  </div>

  <div class="filters">
    <button onclick="filterTasks('all')" class="active">Todas</button>
    <button onclick="filterTasks('pending')">Pendentes</button>
    <button onclick="filterTasks('done')">Conclu√≠das</button>
  </div>

  <ul id="taskList"></ul>
</div>

<script>
  let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
  let currentFilter = 'all';
  let dragSourceIndex = null;

  // Tema
  function applyTheme() {
    const isDark = localStorage.getItem("theme") === "dark";
    document.body.classList.toggle("dark", isDark);
  }

  function toggleTheme() {
    const isDark = document.body.classList.contains("dark");
    localStorage.setItem("theme", isDark ? "light" : "dark");
    applyTheme();
  }

  applyTheme();

  function saveTasks() {
    localStorage.setItem('tasks', JSON.stringify(tasks));
  }

  function addTask() {
    const textInput = document.getElementById("taskText");
    const timeInput = document.getElementById("taskTime");
    const text = textInput.value.trim();
    const time = timeInput.value;

    if (!text) return;

    tasks.push({
      id: Date.now(),
      text,
      time,
      done: false
    });

    textInput.value = "";
    timeInput.value = "";
    saveTasks();
    renderTasks();
  }

  function toggleDone(id) {
    const task = tasks.find(t => t.id === id);
    task.done = !task.done;
    saveTasks();
    renderTasks();
  }

  function deleteTask(id) {
    tasks = tasks.filter(t => t.id !== id);
    saveTasks();
    renderTasks();
  }

  function editTask(id) {
    const newText = prompt("Editar tarefa:");
    if (newText !== null && newText.trim() !== "") {
      const task = tasks.find(t => t.id === id);
      task.text = newText.trim();
      saveTasks();
      renderTasks();
    }
  }

  function filterTasks(type) {
    currentFilter = type;
    document.querySelectorAll('.filters button').forEach(btn => btn.classList.remove('active'));
    document.querySelector(`.filters button[onclick="filterTasks('${type}')"]`).classList.add('active');
    renderTasks();
  }

  function renderTasks() {
    const list = document.getElementById("taskList");
    const search = document.getElementById("searchInput").value.toLowerCase();
    list.innerHTML = "";

    let filtered = tasks;
    if (currentFilter === "pending") filtered = tasks.filter(t => !t.done);
    else if (currentFilter === "done") filtered = tasks.filter(t => t.done);

    if (search) {
      filtered = filtered.filter(t => t.text.toLowerCase().includes(search));
    }

    filtered.forEach((task, index) => {
      const li = document.createElement("li");
      li.className = `task ${task.done ? "completed" : ""}`;
      li.setAttribute("draggable", true);

      // Drag events
      li.addEventListener("dragstart", () => dragSourceIndex = index);
      li.addEventListener("dragover", e => e.preventDefault());
      li.addEventListener("drop", () => {
        if (dragSourceIndex !== null) {
          const draggedTask = filtered[dragSourceIndex];
          const targetTask = task;

          const realSourceIndex = tasks.findIndex(t => t.id === draggedTask.id);
          const realTargetIndex = tasks.findIndex(t => t.id === targetTask.id);

          tasks.splice(realSourceIndex, 1);
          tasks.splice(realTargetIndex, 0, draggedTask);

          saveTasks();
          renderTasks();
        }
      });

      li.innerHTML = `
        <input type="checkbox" onchange="toggleDone(${task.id})" ${task.done ? "checked" : ""}>
        <div class="task-info">
          <span class="task-text">${task.text}</span>
          ${task.time ? `<span class="hora">üïí ${task.time}</span>` : ""}
        </div>
        <span class="actions">
          <span class="edit" onclick="editTask(${task.id})">‚úè</span>
          <span onclick="deleteTask(${task.id})">üóë</span>
        </span>
      `;

      list.appendChild(li);
    });
  }

  renderTasks();
</script>

</body>
</html>
